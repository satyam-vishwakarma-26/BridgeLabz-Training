
CREATE DATABASE library_management;
USE library_management;


CREATE TABLE book (
    book_id INT PRIMARY KEY,
    title VARCHAR(100),
    author VARCHAR(50),
    total_copies INT,
    available_copies INT
);


CREATE TABLE student (
    student_id INT PRIMARY KEY,
    student_name VARCHAR(50)
);


CREATE TABLE borrow_record (
    borrow_id INT AUTO_INCREMENT PRIMARY KEY,
    student_id INT,
    book_id INT,
    borrow_date DATE,
    return_date DATE,
    FOREIGN KEY (student_id) REFERENCES student(student_id),
    FOREIGN KEY (book_id) REFERENCES book(book_id)
);


INSERT INTO book VALUES
(1, 'Java Programming', 'James Gosling', 5, 5),
(2, 'Database Systems', 'C.J. Date', 3, 3);

INSERT INTO student VALUES
(101, 'Alice'),
(102, 'Bob');
select * from student;
+------------+--------------+
| student_id | student_name |
+------------+--------------+
|        101 | Alice        |
|        102 | Bob          |
+------------+--------------+


START TRANSACTION;

INSERT INTO borrow_record (student_id, book_id, borrow_date)
VALUES (101, 1, CURDATE());

UPDATE book
SET available_copies = available_copies - 1
WHERE book_id = 1 AND available_copies > 0;

COMMIT;


 select * from book;
+---------+------------------+---------------+--------------+------------------+
| book_id | title            | author        | total_copies | available_copies |
+---------+------------------+---------------+--------------+------------------+
|       1 | Java Programming | James Gosling |            5 |                4 |
|       2 | Database Systems | C.J. Date     |            3 |                3 |
+---------+------------------+---------------+--------------+------------------+



UPDATE borrow_record
SET return_date = CURDATE()
WHERE borrow_id = 1;

UPDATE book
SET available_copies = available_copies + 1
WHERE book_id = 1;

 select * from book;
+---------+------------------+---------------+--------------+------------------+
| book_id | title            | author        | total_copies | available_copies |
+---------+------------------+---------------+--------------+------------------+
|       1 | Java Programming | James Gosling |            5 |                5 |
|       2 | Database Systems | C.J. Date     |            3 |                3 |
+------------------------------------------------------------------------------+


SELECT 
    br.borrow_id,
    s.student_name,
    b.title,
    GREATEST(DATEDIFF(CURDATE(), br.borrow_date) - 7, 0) * 10 AS fine_amount
FROM borrow_record br
JOIN student s ON br.student_id = s.student_id
JOIN book b ON br.book_id = b.book_id
WHERE br.return_date IS NULL;





 SELECT s.student_name, b.title, br.borrow_date, br.return_date
    -> FROM borrow_record br
    -> JOIN student s ON br.student_id = s.student_id
    -> JOIN book b ON br.book_id = b.book_id;
+--------------+------------------+-------------+-------------+
| student_name | title            | borrow_date | return_date |
+--------------+------------------+-------------+-------------+
| Alice        | Java Programming | 2026-02-08  | 2026-02-08  |
+--------------+------------------+-------------+-------------+